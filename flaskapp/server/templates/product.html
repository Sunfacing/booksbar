<!DOCTYPE html>
<html lang="en">
    <head>
      <title>Booksbar | {{kingstone['title']}}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <style>
          /* Make the image fully responsive */
          .carousel-inner img {
            width: 100%;
            height: 100%;
          }
          </style>
    
      </head>
    <body>
        <nav class="navbar bg-dark">
            <a class="navbar-brand" href="{{ url_for('index')}}" style="color: #ffffff;"><img src='https://dewey.tailorbrands.com/production/brand_version_mockup_image/445/6331351445_00ba94c2-523c-42d8-9712-1924f4621988.png?cb=1636274980' style="width: 60%;"></a>
            <button class="btn btn-dark" type="submit" ><i class="material-icons large">account_circle</i></button> 
        </nav>
        <div id="mySidenav" class="sidenav bg-dark" >
          <a class="navbar-brand" style="color: #ffffff;"><img src='https://dewey.tailorbrands.com/production/brand_version_mockup_image/445/6331351445_00ba94c2-523c-42d8-9712-1924f4621988.png?cb=1636274980' style="width: 100%;"></a>
          <a href="javascript:void(0)" class="closebtn bg-dark" onclick="closeNav()">&times;</a>
          {% for each in nav_sec%}
            <a href="/{{ each }}"><h5 class="section_nav" style="color: #ffffff; font-size: medium;">{{each}}</h5></a>
          {% endfor %}
        </div>
        <div style="margin-top:10px">
        </div>
        <span class="navbtn btn btn-dark my-2 my-sm-0" href="#" role="button" onclick="openNav()" style=" border-radius: 7px;">&#9776;</span>
        <div class="row">
          <div class="container col-sm-2" style="margin-left:0px;"></div>
          <div class="container col-sm-8" style="margin-left:0px;">
            <ul class="breadcrumb bg-light" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px;">
              <li style="margin-right: 10px; font-weight: bolder;">分類: </li>
              <li><a href="http://127.0.0.1:5000/{{kingstone['section']}}" style="margin-right: 10px; font-weight: bold; color:#343A40">{{kingstone['section']}}</a></li>
              <li style="margin-right: 10px; font-weight: bold;">⯈</li>
              <li><a href="http://127.0.0.1:5000/{{kingstone['section']}}?category_nm={{kingstone['category']}}" style="margin-right: 10px; font-weight: bold; color:#343A40">{{kingstone['category']}}</a></li>
              <li style="margin-right: 10px; font-weight: bold;">⯈</li>
              <li><a href="http://127.0.0.1:5000/{{kingstone['section']}}?category_nm={{kingstone['category']}}&subcate_nm={{kingstone['subcategory']}}" style="margin-right: 10px; font-weight: bold; color:#343A40">{{kingstone['subcategory']}}</a></li>
            </ul>       
          </div>
          
          <div class="container col-sm-2" style="margin-left:0px;"></div>
          
        </div>
        <div class="row">
          <div class="container col-sm-2" style="margin-left:0px;"></div>
          <div class="container col" style="margin-left:0px;" >
            <div id="demo" class="carousel slide" data-ride="carousel" style="max-width: 100%;box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; ">
              <!-- Indicators -->
              <ul class="carousel-indicators ">
                <li data-target="#demo" data-slide-to="0" class="active"></li>
                {% for pic in pic_list %}
                <li data-target="#demo" data-slide-to="{{ pic[1] }}"></li>
                {% endfor %}
              </ul> 
              <!-- The slideshow -->
              <div class="carousel-inner "  >
                <div class="carousel-item active">
                  <img src="{{kingstone['cover_photo']}}" alt="Los Angeles" width="100%" height="100%">
                </div>
                {% for pic in pic_list %}
                <div class="carousel-item">
                  <img src="{{ pic[0] }}" alt="Chicago" width="100%" height="100%" >
                </div>
                {% endfor %}
                <!-- Left and right controls -->
                <a class="carousel-control-prev" href="#demo" data-slide="prev""> 
                  <span class="carousel-control-prev-icon bg-dark" ></span>
                </a>
                <a class="carousel-control-next" href="#demo" data-slide="next">
                  <span class="carousel-control-next-icon bg-dark"></span>
                </a>
              </div>
            </div>
          </div>
          <div class="container col" style="padding-right:10px;">
            <div class="row bg-dark" style="max-width: 100%;box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; padding: 30px; border-radius: 7px; color: #ffffff;">
              <h4 style="font-weight: bold;">{{kingstone['title']}}</h4>
            </div>
            <div class="row" style="max-width: 100%;box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; padding: 20px; margin-top: 20px; border-radius: 7px;">
              <div>
              <h5 style="font-size: medium; font-weight: bold;">作者: {{kingstone['author']}}</h5>
              <h5 style="font-size: medium; font-weight: bold;">出版社: {{kingstone['publisher']}}</h5>
              <h5 style="font-size: medium; font-weight: bold;">出版日: {{kingstone['publish_date']}}</h5>
              <h5 style="font-size: medium; font-weight: bold;">ISBN: {{kingstone['ISBN']}}</h5>
              <h5 style="font-size: medium; font-weight: bold;">頁數: {{kingstone['page']}}</h5>
              <h5 style="font-size: medium; font-weight: bold;">尺寸: {{kingstone['size']}}</h5>
              </div>
            </div>
            <div class="row" style="max-width: 100%;box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; padding: 10px; margin-top: 10px;  border-radius: 10px;">
              <div class="container col-3" style="text-align: center;">
                <img src="https://linepaytw-cms.line-scdn.net/v0/fc8cb09e193cc3f5a8e7ebc6910debd296aacb3d84e1f1a2891dd45444a03855.png" style="width: 90px; height: 90px;">
                {% if kingstone['price'] > 0 %} 
                  <h4 style="color: #D52536; font-weight: bold;">{{kingstone['price']}} 元</h4><a href="{{kingstone['product_url']}}" class="btn bg-dark" style="color:white; font-weight: bold;">前往網站</a>
                {% endif %}
              </div>

              <div class="container col-4" style="text-align: center;">
                <img src="https://meet.eslite.com/Content/Images/ThemePavilion/eslite-logo.jpg" style="width: 90px; height: 90px; ">
                {% if eslite['price'] > 0 %}  
                  <h4 style="color: #D52536; font-weight: bold;">{{eslite['price']}} 元</h4><a href="{{eslite['product_url']}}" class="btn bg-dark" style="color:white; font-weight: bold;">前往網站</a>
                {% endif %}
              </div>
              
              <div class="container col-3" style="text-align: center;">
                <img src="https://www.esunbank.com.tw/bank/-/media/esunbank-mobile/images/discount/shops/b_onlineshop/2008.jpg" style="width: 90px; height: 90px;">
                {% if momo['price'] > 0 %}                              
                  <h4 style="color: #D52536; font-weight: bold;">{{momo['price']}} 元</h4><a href="{{momo['product_url']}}" class="btn bg-dark" style="color:white; font-weight: bold;">前往網站</a>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="container col-sm-2" style="margin-left:0px;" id='tracker'>
            <div style="height: 10%;">
            <button type="button" class="btn btn-basic row" id="subcategory" value="?subcate={{kingstone['category_id']}}" onclick="add_to_favorite()"><i class="fas fa-heart" id="heart" style="color:#000000"> 追蹤分類</i></button>
            </div>
            <div style="height: 10%;">
            <button type="button" class="btn btn-basic row" value="?author={{kingstone['author_id']}}" onclick="cancel_favorite()"><i class="fas fa-pen-nib"> 追蹤作者</i></button>
           </div>
           <div style="height: 10%;">
            <button type="button" class="btn btn-basic row" value="?price={{kingstone['isbn_id']}}" onclick="add_to_favorit()"><i class="fas fa-tag"> 追蹤價格</i></button>
          </div>
          <script>
            var tracker = document.getElementById('tracker')
            let button_tag;
            let icon_tag;
            tracker.addEventListener('click', (e) => {
              if (e.target.tagName == 'I') {
                icon_tag = e.target
                button_tag = e.target.parentNode
                value = e.target.parentNode.value;
              } else if (e.target.tagName == 'BUTTON') {
                button_tag = e.target
                icon_tag = e.target.firstChild
                value = e.target.value;
              } else {
                value = 0;
              }
              if ( value != 0) {
              var api = "http://127.0.0.1:5000/api/favorite"+ value;

              fetch(api, {method:'POST'})
                    .then(response => response.json())
                    .then(set_favorite)}
            })
            

            function set_favorite(result) {
                if (result.response == 'added') {
                  button_tag.className = button_tag.className.replace("btn-basic", "btn-danger");
                  icon_tag.style.color = "#ffffff"
                } else if ( result.response == 'cancelled') {
                  button_tag.className = button_tag.className.replace("btn-danger", "btn-basic");
                  icon_tag.style.color = "#000000"                  
                } else {
                  alert('請先登入')
                }
            }
          </script>
          </div>
        </div>
        
        <div class="container col-sm-8" style="margin-top: 30px;">
          <div id="naver">
          <ul  class="nav nav-pills navbar navbar-expand-sm bg-light" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px;">
            <li><a data-toggle="pill" href="#table_of_content" class="btn active" style="margin:1px; color:#f1f1f1; border-radius: 5px; font-weight: bold;">目錄大綱</a></li>
            <li><a data-toggle="pill" href="#description" class="btn" style="margin:1px; color:#f1f1f1; border-radius: 5px; font-weight: bold;">內容簡介</a></li>
            <li><a data-toggle="pill" href="#author_intro" class="btn" style="margin:1px; color:#f1f1f1; border-radius: 5px; font-weight: bold;">作者介紹</a></li>
            <li><a data-toggle="pill" href="#menu3" class="btn" style="margin:1px; color:#f1f1f1; border-radius: 5px; font-weight: bold;">讀者評論</a></li>
          </ul>
        </div>
        <style>
          a.btn.active {
            background-color: #D52536;
            color: white;           
          }
          a.btn {
            background-color: #343A40;
            color: white;           
          }
        </style>
          <div class="tab-content">
            <div id="table_of_content" class="tab-pane fade in active" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px; padding: 40px;"> 
            </div>
            <div id="description" class="tab-pane fade" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px; padding: 40px;">
            </div>
            <div id="author_intro" class="tab-pane fade" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px; padding: 40px;">
            </div>
            <div id="menu3" class="tab-pane fade" style="box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px; padding: 40px;">
            </div>
          </div>
        </div> 
        <script>
          function render(productList){
              var table_of_content = document.createElement('ul');
              var li_table_of_content = document.createElement('li');
              li_table_of_content.innerHTML = productList.table_of_content
              table_of_content.appendChild(li_table_of_content); 
              document.getElementById('table_of_content').append(table_of_content);
             
              var description = document.createElement('ul');
              var li_description = document.createElement('li');
              li_description.innerHTML = '<span>' + productList.description + '</span>'
              description.appendChild(li_description); 
              document.getElementById('description').append(description);

              var author_intro = document.createElement('ul');
              var li_author_intro = document.createElement('li');
              li_author_intro.innerHTML = productList.author_intro
              author_intro.appendChild(li_author_intro); 
              document.getElementById('author_intro').append(author_intro);
          };
                  
          fetch("http://127.0.0.1:5000/product/api/bookinfo/{{kingstone['isbn_id']}}")
              .then( response => response.json())
              .then(render)
              // .finally(() => alert('Hey'))
        </script>        
    </body>


    
    <script>
      var slideIndex = 1;
      showSlides(slideIndex);
      
      function plusSlides(n) {
        showSlides(slideIndex += n);
      }
      
      function currentSlide(n) {
        showSlides(slideIndex = n);
      }
      
      function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("mySlides");
        var dots = document.getElementsByClassName("demo");
        var captionText = document.getElementById("caption");
        if (n > slides.length) {slideIndex = 1}
        if (n < 1) {slideIndex = slides.length}
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex-1].style.display = "block";
        dots[slideIndex-1].className += " active";
        captionText.innerHTML = dots[slideIndex-1].alt;
      }
    </script>
    <style>
      body {
        font-family: Arial;
        margin: 0;
      }
      
      * {
        box-sizing: border-box;
      }
      
      img {
        vertical-align: middle;
      }
      
      /* Position the image container (needed to position the left and right arrows) */
      .container {
        position: relative;
      }
      
      /* Hide the images by default */
      .mySlides {
        display: none;
      }
      
      /* Add a pointer when hovering over the thumbnail images */
      .cursor {
        cursor: pointer;
      }
      
      /* Next & previous buttons */
      .prev,
      .next {
        cursor: pointer;
        position: absolute;
        top: 40%;
        width: auto;
        padding: 16px;
        margin-top: -50px;
        color: white;
        font-weight: bold;
        font-size: 20px;
        border-radius: 0 3px 3px 0;
        user-select: none;
        -webkit-user-select: none;
      }
      
      /* Position the "next button" to the right */
      .next {
        right: 0;
        border-radius: 3px 0 0 3px;
      }
      
      /* On hover, add a black background color with a little bit see-through */
      .prev:hover,
      .next:hover {
        background-color: rgba(0, 0, 0, 0.8);
      }
      
      /* Number text (1/3 etc) */
      .numbertext {
        color: #f2f2f2;
        font-size: 12px;
        padding: 8px 12px;
        position: absolute;
        top: 0;
      }
      
      /* Container for image text */
      .caption-container {
        text-align: center;
        background-color: #222;
        padding: 2px 16px;
        color: white;
      }
      
      .row:after {
        content: "";
        display: table;
        clear: both;
      }
      
      /* Six columns side by side */
      .column {
        float: left;
        width: 16.66%;
      }
      
      /* Add a transparency effect for thumnbail images */
      .demo {
        opacity: 0.6;
      }
      
      .active,
      .demo:hover {
        opacity: 1;
      }
    </style>   
    <style>
      body {
        font-family: "Lato", sans-serif;
      }
      
      .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
      }
      
      .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
      }
      
      .sidenav a:hover {
        color: #f1f1f1;
      }
      
      .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
      }
      
      @media screen and (max-height: 450px) {
        .sidenav {padding-top: 15px;}
        .sidenav a {font-size: 18px;}
      }
    </style>
    <script>
        function openNav() {
          document.getElementById("mySidenav").style.width = "250px";
        }
        
        function closeNav() {
          document.getElementById("mySidenav").style.width = "0";
        }
    </script>
</html>