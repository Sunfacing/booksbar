<!DOCTYPE html>
<html>
    <head>
        <title>Booksbar | Search: {{ term }}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="https://d3bu8utwyaxpsl.cloudfront.net/open-book.png">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    </head>
    <body>
        <nav class="navbar" style="background-color: #393d3f;">
            <a class="navbar-brand" style="color: #ffffff;" href="{{ url_for('index')}}"><img src='https://dewey.tailorbrands.com/production/brand_version_mockup_image/380/6391619380_b1cf68eb-1598-4eb2-987f-bd1ab6196133.png?cb=1637199110' style="width: 60%;"></a>
            {% if 'loggedin' in session %}
                <a href="/member"><i class="fas fa-user-circle fa-2x" style="color: #ffffff" ></i></a>        
            {% else %}
                <a onclick="document.getElementById('id01').style.display='block'" ><i class="fas fa-user-circle fa-2x" style="color: #ffffff" ></i></a>
            {% endif %}
          </nav>
          {% include 'login.html' %}
        <main>
            <div id="loading" style="margin: auto; margin-top: 120px;"></div>
            <div id="content">
            <div class="row" style="margin-top: 5vh;">
                <div class="container col-sm-2">
                    {% if count > 0 %}
                        <h3 style="font-weight: bold; color:#393d3f">關鍵字: {{ term }}</h3><br> 
                        <h3 style="font-weight: bold; color:#393d3f">查詢結果: {{ count }} 筆</h3>
                    {% endif %}
                </div>

                <div class="container col-sm-6" style="margin-left:0px;">  
                {% if count == 0 %}
                    <h2 class="d-flex justify-content-center" style="font-weight: bold; margin-top: 30vh; color:#393d3f; margin-bottom: 30px;">找不到搜尋的關鍵字: {{ term }}</h2>
                    <form class="form-inline d-flex justify-content-center" action="/keyword">
                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="search" required>
                        <button class="btn btn-dark my-2 my-sm-0" type="submit"  onclick="loading();" style="background-color:#393d3f; border-color: #393d3f; font-weight:bold">搜尋書名</button>
                    </form>
                {% endif %}            
                {% for category, products in product_list.items() %}
                    <div style="margin-top: 10px; margin-bottom: 10px; position: sticky; top: 0; z-index: 1; ">
                        <ul class="breadcrumb" style="background-color: #393d3f; position: sticky; top: 0; z-index: 1;  box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 5px; margin-bottom: 8px;">
                            <li style="margin-right: 10px; font-weight: bold; color:#ffffff; background-color: #393d3f;">{{ category }}</li>
                        </ul>
                    </div>
                    {% for product in products %}
                        <div class="card mb-3 w3-animate-opacity" style="max-width: 100%;box-shadow: 0 8px 16px 0 rgba(133, 104, 104, 0.2); border:0px; border-radius: 7px;">
                            <a href="product/{{product['isbn_id']}}" style="text-decoration: none; color: #393d3f;">
                            <div class="row no-gutters" >
                            <div class="col-md-3 " >
                                <img src="{{product['cover_photo']}}" class="card-img" onerror="this.onerror=null;this.src='https://dewey.tailorbrands.com/production/brand_version_mockup_image/674/6392009674_d59d0209-6c03-4b75-9084-0e5fffb34183.png?cb=1637205240'" style="height: 85%; width: 85%; margin-top: 15px; margin-left: 15px;">
                                </div>
                                <div class="col-md-9">
                                    <div class="card-body" >
                                        <h5 class="card-title" style="font-weight: bold;">{{product['title']}}</h5>
                                        <p class="card-text">{{product['description'][:100]}}....</p>
                                        <p class="card-text" style="font-weight: bold;">作者: {{product['author'][:100]}}</p>
                                    </div>
                                </div>
                            </div>
                            </a>    
                        </div>   
                    {% endfor %}
                {% endfor %}
                </div>
                <div class="container col-sm-2" style="margin-left:0px;">
                    <button onclick="topFunction()" id="myBtn" title="Go to top">▲</button>    
                </div>


            </div>
            <script type="text/javascript">
                function loading(){
                    $("#loading").show();
                    $("#content").hide();       
                }
              </script>
              <style>
                div#loading {
                    width: 700px;
                    height: 600px;
                    display: none;
                    background: url(/static/loadingimage.gif) no-repeat;
                    cursor: wait;
                    }
              </style>   
                <style>
                    .card:hover {
                        transform: scale(1.05);
                        }
                </style>       

            </div>  
              
            <style>
              #myBtn {
                display: none;
                position: fixed;
                bottom: 20px;
                right: 30px;
                z-index: 99;
                font-size: 18px;
                border: none;
                outline: none;
                background-color: #393d3f;
                color: #ffffff;
                cursor: pointer;
                padding: 10px;
                margin: 30px;
                border-radius: 7px;
                height: 50px;
                width: 50px;
              }
              
              #myBtn:hover {
                background-color: #cc444b;
              }
              </style>
            <script>
              //Get the button
              var mybutton = document.getElementById("myBtn");
              
              // When the user scrolls down 20px from the top of the document, show the button
              window.onscroll = function() {scrollFunction()};
              
              function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                  mybutton.style.display = "block";
                } else {
                  mybutton.style.display = "none";
                }
              }
              
              // When the user clicks on the button, scroll to the top of the document
              function topFunction() {
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
              }
            </script>
        </main>
        </body>